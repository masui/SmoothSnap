<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<script language="javascript">
<!--
var mouseupy = 0;
var mousedowny = 0;
var mousey = 0;

var scheight = window.innerHeight;             // スクロールバーの長さ
var bodyheight;                                // スクロール対象の長さ
var center = 0;

var snap0 = [];                                // スナップする位置 レベル0 (粗い)
var snap1 = [];                                // スナップする位置 レベル1 (細かい)
var scmap = [];
var eiwadoc = parent.eiwalist.document;
var eiwawin = parent.eiwalist.window;

eiwawin.onload = function (){
  h2tags = eiwadoc.getElementsByTagName('h2');
  snap0 = [];
  snap0.push(0);
  for(var i=0;i<h2tags.length;i++){
    snap0.push(h2tags[i].offsetTop);
  }
  h3tags = eiwadoc.getElementsByTagName('h3');
  snap1 = [];
  for(var i=0;i<snap0.length;i++){
    snap1.push(snap0[i]);
  }
  for(var i=0;i<h3tags.length;i++){
    snap1.push(h3tags[i].offsetTop);
  }
  snap1.sort(function(a,b){ return a-b; });

  // parent.eiwatest.document.body.innerHTML = snap1.join('<br>');

  bodyheight = eiwadoc.body.scrollHeight;

  setup_map();
}

function findsnap(y,snap){
  var bodyy = Math.floor(bodyheight * y / scheight);
  for(var i=0;i<snap.length;i++){
    if(snap[i] >= bodyy){
      return snap[i];
    }
  }
  return bodyheight;
}

//                 <-50-->                  slider領域
//                       |--------------------------------------------------|
//                       0                                              clientHeight
//                 |--------------------------mousey-------------------------------|
//                              y <---- d ------>
//
//
//        0                     p                                                                    scrollHeight
//        |===================================center=======================================================|
//  snap0 |           |          |       |             |      |           | 
//  snap1 |    |   |  |   |  |   |   |   |  |   |  |   |      |  |   |    |

function setup_map(){
  var y;
  var d;
  var p;
  var count;
  var i;

  // 現在地の周辺のスナップ位置を知る
  var uppersnap = 0;
  var lowersnap = 0;
  for(i=0;i<snap1.length;i++){
    if(snap1[i] > center){
      if(i > 0){
        uppersnap = snap1[i-1];
      }
      lowersnap = snap1[i];
      break;
    }
    if(i > 0){
      uppersnap = snap1[i-1];
    }
    lowersnap = snap1[i];
  }

  for(y=mousey;y>= -50;y--){
    d = mousey - y;
    p = center - d * d;
    if(d >= 30 && p < uppersnap) break;
    scmap[y] = p;
  }
  if(y > -50){
    p = center - d * d;
    // 0〜p までのスナップ場所の数を数える
    if(p >= 0){
      for(i=0,count=0;i<snap1.length;i++){
        if(snap1[i] > p) break;
        count++;
      }
      for(i= -50;i<=y;i++){
        var ind = Math.floor(((i+50) * count)/(y+50));
        scmap[i] = snap1[ind];
      }

      y = Math.floor((y+50)/2-50);
      p = scmap[y-1];
      // 0〜p までのスナップ場所の数を数える
      if(p >= 0){
        for(i=0,count=0;i<snap0.length;i++){
          if(snap0[i] > p) break;
          count++;
        }
        for(i= -50;i<=y;i++){
          var ind = Math.floor(((i+50) * count)/(y+50));
          scmap[i] = snap0[ind];
        }
      }
    }
  }

  for(y=mousey+1;y<scheight+50;y++){
    d = y-mousey;
    p = center + d * d;
    if(d >= 30 && p > lowersnap) break;
    scmap[y] = p;
  }
  if(y <scheight+50){
    p = center + d * d;
    // p〜 のスナップ場所の数を数える
    if(p < bodyheight){
      for(i=snap1.length-1,count=0;i>=0;i--){
        if(snap1[i] < p) break;
        count++;
      }
      for(i=scheight+50-1;i>y;i--){
        var ind = Math.floor(((scheight+50-i) * count)/(scheight+50-y));
        scmap[i] = snap1[snap1.length-1-ind];
      }
//parent.eiwatest.document.body.innerHTML = scmap.length + '<br>' + scmap.join('<br>');

      y = Math.floor(scheight+50-1 - (scheight+50-1-y)/2);
      p = scmap[y];
      for(i=snap0.length-1,count=0;i>=0;i--){
        if(snap0[i] < p) break;
        count++;
      }
      for(i=scheight+50-1;i>y;i--){
        var ind = Math.floor(((scheight+50-i) * count)/(scheight+50-y));
        scmap[i] = snap0[snap0.length-1-ind];
      }
    }
  }
}

var clicked = false;

function scroll(event){
//  center = scmap[mousey];
//  parent.eiwalist.document.body.scrollTop = scmap[mousey];
}

function mousedown(event){
  clicked = true;
  mousedowny = event.clientY;
  mousey = event.clientY;
  setup_map();
}

function mouseup(event){
  clicked = false;
  mouseupy = event.clientY;
  // var center = Math.floor(bodyheight * mouseupy / scheight);
  parent.eiwalist.document.body.scrollTop = scmap[mousey];
}

function mousemove(event){
  if(clicked){
    mousey = event.clientY;
    center = scmap[mousey];
    parent.eiwalist.document.body.scrollTop = scmap[mousey];
//parent.eiwatest.document.body.innerHTML = mousey;
  }
}

addEventListener('mousedown', mousedown, true);
addEventListener('mouseup', mouseup, true);
addEventListener('mousemove', mousemove, true);
addEventListener('scroll', scroll, true);
</script>
<pre>







































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































</pre>
</body>
</html>
